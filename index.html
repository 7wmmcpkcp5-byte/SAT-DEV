<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SAT PRO MASTER - v1.2</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
    :root {
        --bg-primary:#050816;
        --bg-secondary:#080d18;
        --bg-surface:#0f172a;
        --primary:#3b82f6;
        --accent:#8b5cf6;
        --text:#e5e7eb;
        --text-soft:#9ca3af;
        --radius:18px;
        --radius-sm:12px;
        --success:#10b981;
        --warning:#f59e0b;
        --error:#ef4444;
        --shadow-soft: 10px 10px 22px #02040a, -10px -10px 22px #101a30;
        --shadow-inset: inset 6px 6px 12px #050914, inset -6px -6px 12px #18233c;
    }

    * {margin:0;padding:0;box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    
    body {
        font-family:-apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
        background:radial-gradient(circle at top, #0b1220 0, #020617 45%, #020617 100%);
        color:var(--text);
        min-height:100vh;
        -webkit-font-smoothing: antialiased;
        padding-bottom: 80px;
    }

    .app {
        max-width:440px;
        margin:auto;
        padding:0.85rem;
        min-height:100vh;
        display:flex;
        flex-direction:column;
    }

    /* HEADER ACTUALIZADO */
    header {
        text-align:center;
        padding:1rem 0 0.8rem;
        border-radius:24px;
        margin-bottom:0.3rem;
        background:linear-gradient(135deg, rgba(15,23,42,0.95), rgba(30,64,175,0.85));
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(255,255,255,0.05);
    }

    header h1 {
        font-size:1.35rem;
        font-weight:800;
        letter-spacing:0.08em;
        text-transform:uppercase;
        background:linear-gradient(135deg,var(--primary),var(--accent),#e5e7eb);
        -webkit-background-clip:text;
        -webkit-text-fill-color:transparent;
        line-height: 1.1;
    }

    .app-version {
        font-size: 0.65rem;
        color: rgba(255,255,255,0.5);
        margin-top: 4px;
        font-weight: 500;
        letter-spacing: 0.05em;
        text-transform: uppercase;
    }

    /* USER BAR */
    .user-bar {
        display:flex;
        align-items:center;
        gap:0.85rem;
        margin:1rem 0 0.9rem;
        padding:0.7rem 0.6rem;
        border-radius:22px;
        background:var(--bg-surface);
        box-shadow: var(--shadow-soft);
    }

    .avatar {
        width:44px;height:44px;border-radius:50%;
        background:linear-gradient(135deg, var(--bg-secondary), #1e293b);
        display:flex;align-items:center;justify-content:center;
        font-weight:700;
        font-size:0.95rem;
        color:var(--text);
        box-shadow: 4px 4px 10px #02040a, -4px -4px 10px #1c2640;
        border: 2px solid rgba(59, 130, 246, 0.3);
    }

    .user-info { flex: 1; }
    .user-info .name {font-size:0.88rem;font-weight:600;}
    .user-info .level {font-size:0.72rem;color:var(--primary); font-weight: 600;}

    /* SECTIONS */
    section {display:none; animation: fadeIn 0.3s ease;}
    section.active {display:block;}

    @keyframes fadeIn {
        from {opacity:0; transform:translateY(5px);}
        to {opacity:1; transform:translateY(0);}
    }

    /* STATS & CHARTS (NUEVO DISEÑO) */
    .chart-card {
        background:var(--bg-surface);
        padding:1.2rem;
        border-radius:var(--radius);
        margin-bottom:1rem;
        box-shadow: var(--shadow-soft);
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    /* Donut Chart CSS puro */
    .donut-wrapper {
        position: relative;
        width: 100px;
        height: 100px;
        flex-shrink: 0;
    }
    
    .donut-chart {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        /* El gradiente se actualizará via JS */
        background: conic-gradient(var(--primary) 0% 0%, var(--bg-secondary) 0% 100%); 
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 5px 5px 15px #050816, -5px -5px 15px #19253f;
    }

    .donut-inner {
        width: 75%;
        height: 75%;
        background: var(--bg-surface);
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: inset 2px 2px 5px #050816, inset -2px -2px 5px #19253f;
    }

    .donut-value { font-size: 1.1rem; font-weight: 800; color: var(--text); }
    .donut-label { font-size: 0.6rem; color: var(--text-soft); }

    .chart-details { flex: 1; }
    
    /* Barras de progreso por tópico */
    .topic-bar-container { margin-bottom: 0.8rem; }
    .topic-header { display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 3px; }
    .topic-track { 
        height: 6px; background: var(--bg-secondary); border-radius: 10px; overflow: hidden; 
        box-shadow: inset 1px 1px 3px rgba(0,0,0,0.5);
    }
    .topic-fill { height: 100%; border-radius: 10px; }
    
    /* Gráfico de Barras verticales (Activity) */
    .activity-chart {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        height: 80px;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255,255,255,0.05);
    }
    .act-bar-group { display: flex; flex-direction: column; align-items: center; gap: 5px; flex: 1; }
    .act-bar { 
        width: 8px; 
        background: var(--bg-secondary); 
        border-radius: 4px; 
        transition: height 0.5s ease;
    }
    .act-day { font-size: 0.6rem; color: var(--text-soft); }
    .act-bar.active { background: linear-gradient(to top, var(--primary), var(--accent)); box-shadow: 0 0 10px rgba(59,130,246,0.5); }

    /* ESTILOS COMUNES ANTERIORES */
    .stats-row { display:grid; grid-template-columns:1fr 1fr; gap:0.6rem; margin-bottom:0.9rem; }
    .stat-box { background:var(--bg-surface); padding:0.85rem; border-radius:var(--radius); text-align:left; box-shadow: var(--shadow-soft); }
    .stat-box .value { font-size:1.3rem; font-weight:700; color: var(--text); }
    .stat-box .label { font-size:0.7rem; color:var(--text-soft); }

    .grid { display:grid; grid-template-columns:1fr 1fr; gap:0.65rem; margin-bottom:1rem; }
    .grid-card { background:var(--bg-surface); padding:0.95rem; border-radius:var(--radius); cursor:pointer; transition:all 0.18s ease; box-shadow: var(--shadow-soft); border: 1px solid transparent; }
    .grid-card:hover { transform:translateY(-2px); border-color: rgba(59,130,246,0.3); background:radial-gradient(circle at top left, rgba(59,130,246,0.15), var(--bg-surface)); }
    
    .practice-item { background:var(--bg-surface); padding:0.9rem; border-radius:var(--radius); margin-bottom: 0.7rem; cursor:pointer; box-shadow: var(--shadow-soft); }
    .difficulty-badge { padding:0.2rem 0.6rem; border-radius:999px; font-size:0.65rem; font-weight:600; }
    .difficulty-medium { background:rgba(245, 158, 11, 0.2); color:var(--warning); }
    .difficulty-hard { background:rgba(239, 68, 68, 0.2); color:var(--error); }

    /* QUIZ STYLES */
    .quiz-box { background:var(--bg-surface); padding:1rem; border-radius:var(--radius); box-shadow: var(--shadow-soft); min-height: 400px; display: flex; flex-direction: column; }
    .quiz-option { background:var(--bg-secondary); padding:1rem; border-radius:var(--radius-sm); margin-bottom:0.6rem; font-size:0.9rem; cursor:pointer; transition:all 0.2s; border: 1px solid rgba(255,255,255,0.03); }
    .quiz-option.selected { background:var(--primary); color:white; }
    .quiz-option.correct { background:var(--success); color:white; }
    .quiz-option.incorrect { background:var(--error); color:white; }
    .quiz-btn { background:linear-gradient(135deg,var(--primary),var(--accent)); color:white; border:none; padding:0.7rem; border-radius:999px; width: 100%; font-weight:600; margin-top: auto; }
    .quiz-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .bottom-nav { display:flex; gap:0.4rem; padding:0.5rem; width: calc(100% - 1.7rem); max-width: 415px; border-radius:24px; background:rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); position:fixed; bottom:1rem; left: 50%; transform: translateX(-50%); z-index: 100; border: 1px solid rgba(255,255,255,0.05); }
    .nav-tab { flex:1; text-align:center; padding:0.6rem 0; font-size:0.7rem; font-weight: 600; border-radius:999px; color:var(--text-soft); }
    .nav-tab.active { background:var(--bg-secondary); color:var(--primary); box-shadow: var(--shadow-inset); }

    .katex { font-size: 1.1em; color: #fff; }
</style>
</head>

<body>

<div class="app">

    <header>
        <h1>SAT PRO MASTER</h1>
        <p class="app-version">Generated by Gemini • v1.2</p>
    </header>

    <div class="user-bar">
        <div class="avatar">A</div>
        <div class="user-info">
            <div class="name">Alex Student</div>
            <div class="level" id="user-level-text">Nivel 1</div>
        </div>
        <div style="text-align: right;">
             <span style="font-size:0.7rem; color:var(--text-soft)">XP</span>
             <div style="font-weight:700; color:var(--accent)" id="user-xp">0</div>
        </div>
    </div>

    <section id="home" class="active">
        <div class="stats-row">
            <div class="stat-box">
                <div class="value" id="home-score">--</div>
                <div class="label">Est. Score</div>
            </div>
            <div class="stat-box">
                <div class="value" id="home-questions">0</div>
                <div class="label">Questions</div>
            </div>
        </div>

        <div class="grid">
            <div class="grid-card" data-section="practice">
                <h3>Practice</h3><p>Start drills</p>
            </div>
            <div class="grid-card" data-section="analytics">
                <h3>Analytics</h3><p>View Charts</p>
            </div>
        </div>
        
        <h3 style="font-size:0.9rem; margin-bottom:0.5rem;">Recent Topics</h3>
        <div class="practice-item" data-category="math">
            <div style="display:flex; justify-content:space-between;">
                <h4>Algebra</h4>
                <span class="difficulty-badge difficulty-medium">Medium</span>
            </div>
            <small style="color:var(--text-soft)">Continue where you left off</small>
        </div>
    </section>

    <section id="practice">
        <h2 style="margin-bottom:1rem;">Select Topic</h2>
        <div class="practice-item" data-category="math">
            <h4>Heart of Algebra</h4>
            <span style="font-size:0.75rem; color:var(--text-soft)">Linear equations, systems</span>
        </div>
        <div class="practice-item" data-category="geometry">
            <h4>Geometry</h4>
            <span style="font-size:0.75rem; color:var(--text-soft)">Circles, triangles, volume</span>
        </div>
    </section>

    <section id="quiz">
        <div class="quiz-box">
            <div style="display:flex; justify-content:space-between; color:var(--text-soft); font-size:0.8rem; margin-bottom:1rem;">
                <span id="quiz-progress">Q 1/5</span>
                <span id="quiz-timer" style="color:var(--warning)">00:00</span>
            </div>
            
            <div id="question-text" style="font-size:1rem; margin-bottom:1.5rem; line-height:1.5;">Loading...</div>
            <div id="options-container"></div>
            
            <div style="display:flex; gap:10px; margin-top:auto;">
                <button class="quiz-btn" id="quit-btn" style="background:var(--bg-secondary); color:var(--text-soft);">Exit</button>
                <button class="quiz-btn" id="next-btn" disabled>Next</button>
            </div>
        </div>
    </section>

    <section id="analytics">
        <h2 style="margin-bottom:1rem;">Performance</h2>
        
        <div class="chart-card">
            <div class="donut-wrapper">
                <div class="donut-chart" id="accuracy-chart">
                    <div class="donut-inner">
                        <div class="donut-value" id="accuracy-val">0%</div>
                        <div class="donut-label">Accuracy</div>
                    </div>
                </div>
            </div>
            
            <div class="chart-details">
                <div class="topic-bar-container">
                    <div class="topic-header">
                        <span>Algebra</span>
                        <span style="color:var(--primary)">High</span>
                    </div>
                    <div class="topic-track"><div class="topic-fill" style="width: 80%; background:var(--primary)"></div></div>
                </div>
                <div class="topic-bar-container">
                    <div class="topic-header">
                        <span>Geometry</span>
                        <span style="color:var(--accent)">Med</span>
                    </div>
                    <div class="topic-track"><div class="topic-fill" style="width: 45%; background:var(--accent)"></div></div>
                </div>
            </div>
        </div>

        <div class="stat-box">
            <h3 style="font-size:0.9rem; margin-bottom:0.5rem">Weekly Activity</h3>
            <div class="activity-chart">
                <div class="act-bar-group"><div class="act-bar" style="height:30%"></div><span class="act-day">M</span></div>
                <div class="act-bar-group"><div class="act-bar" style="height:50%"></div><span class="act-day">T</span></div>
                <div class="act-bar-group"><div class="act-bar active" style="height:80%"></div><span class="act-day">W</span></div>
                <div class="act-bar-group"><div class="act-bar" style="height:20%"></div><span class="act-day">T</span></div>
                <div class="act-bar-group"><div class="act-bar" style="height:40%"></div><span class="act-day">F</span></div>
                <div class="act-bar-group"><div class="act-bar" style="height:10%"></div><span class="act-day">S</span></div>
                <div class="act-bar-group"><div class="act-bar" style="height:10%"></div><span class="act-day">S</span></div>
            </div>
        </div>
    </section>

    <nav class="bottom-nav">
        <div class="nav-tab active" data-section="home">Home</div>
        <div class="nav-tab" data-section="practice">Practice</div>
        <div class="nav-tab" data-section="analytics">Stats</div>
    </nav>

</div>

<script>
    class SATProApp {
        constructor() {
            this.state = { xp: 0, level: 1, questionsDone: 0, correctAnswers: 0 };
            this.activeQuestions = [];
            this.currentQIndex = 0;
            
            // Preguntas Demo
            this.questionBank = {
                math: [
                    { q: "If $$3x + 5 = 20$$, what is $$x$$?", opts: ["3", "5", "15", "25"], corr: 1, diff: "easy" },
                    { q: "Evaluate $$\\frac{x^2 - 1}{x - 1}$$ where $$x \\neq 1$$", opts: ["x", "x-1", "x+1", "1"], corr: 2, diff: "medium" }
                ],
                geometry: [
                    { q: "A circle has radius 4. What is the area?", opts: ["4π", "8π", "16π", "20π"], corr: 2, diff: "hard" }
                ]
            };
            
            this.init();
        }

        init() {
            this.loadProgress();
            this.setupListeners();
            this.updateUI();
        }

        loadProgress() {
            const saved = localStorage.getItem('satPro_v1.2');
            if (saved) this.state = JSON.parse(saved);
        }

        saveProgress() {
            localStorage.setItem('satPro_v1.2', JSON.stringify(this.state));
            this.updateUI();
        }

        updateUI() {
            // Header stats
            document.getElementById('user-xp').textContent = this.state.xp;
            document.getElementById('user-level-text').textContent = "Nivel " + this.state.level;
            document.getElementById('home-questions').textContent = this.state.questionsDone;
            
            // Score Logic
            let score = 400 + (this.state.correctAnswers * 20);
            if(score > 1600) score = 1600;
            document.getElementById('home-score').textContent = score;

            // --- ACTUALIZACIÓN GRÁFICA (STATS) ---
            const total = this.state.questionsDone;
            const correct = this.state.correctAnswers;
            let percent = 0;
            
            if (total > 0) {
                percent = Math.round((correct / total) * 100);
            }

            // Actualizar Donut Chart via CSS Conic Gradient
            const chart = document.getElementById('accuracy-chart');
            if (chart) {
                // El gradiente pinta el % en color primario, el resto en secundario
                chart.style.background = `conic-gradient(var(--primary) 0% ${percent}%, var(--bg-secondary) ${percent}% 100%)`;
            }
            const accVal = document.getElementById('accuracy-val');
            if (accVal) accVal.textContent = `${percent}%`;
        }

        setupListeners() {
            // Navegación
            document.querySelectorAll('.nav-tab, .grid-card').forEach(el => {
                el.addEventListener('click', () => {
                    if (el.dataset.section) this.showSection(el.dataset.section);
                    // Update active tab logic
                    if (el.classList.contains('nav-tab')) {
                        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                        el.classList.add('active');
                    }
                });
            });

            // Start Quiz
            document.querySelectorAll('.practice-item').forEach(item => {
                item.addEventListener('click', () => {
                    const cat = item.dataset.category || 'math';
                    this.startQuiz(cat);
                });
            });

            // Quiz controls
            document.getElementById('next-btn').addEventListener('click', () => this.nextQuestion());
            document.getElementById('quit-btn').addEventListener('click', () => this.showSection('home'));
        }

        showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // Si vamos a stats, refrescar UI
            if(id === 'analytics') this.updateUI();
        }

        startQuiz(cat) {
            this.activeQuestions = this.questionBank[cat] || this.questionBank.math;
            this.currentQIndex = 0;
            this.showSection('quiz');
            this.renderQuestion();
        }

        renderQuestion() {
            const q = this.activeQuestions[this.currentQIndex];
            document.getElementById('question-text').innerHTML = q.q;
            document.getElementById('quiz-progress').textContent = `Q ${this.currentQIndex + 1}/${this.activeQuestions.length}`;
            
            const cont = document.getElementById('options-container');
            cont.innerHTML = '';
            
            q.opts.forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = 'quiz-option';
                div.innerHTML = `<b>${String.fromCharCode(65+idx)})</b> ${opt}`;
                div.onclick = () => this.check(idx, div, q.corr);
                cont.appendChild(div);
            });
            
            document.getElementById('next-btn').disabled = true;
            
            // Render Math
            renderMathInElement(document.getElementById('quiz'), {
                delimiters: [{left: '$$', right: '$$', display: false}]
            });
        }

        check(selected, el, correct) {
            // Evitar doble click
            const opts = document.querySelectorAll('.quiz-option');
            opts.forEach(o => o.style.pointerEvents = 'none');

            if (selected === correct) {
                el.classList.add('correct');
                this.state.xp += 20;
                this.state.correctAnswers++;
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });
            } else {
                el.classList.add('incorrect');
                opts[correct].classList.add('correct');
            }
            
            this.state.questionsDone++;
            this.saveProgress();
            document.getElementById('next-btn').disabled = false;
        }

        nextQuestion() {
            this.currentQIndex++;
            if (this.currentQIndex < this.activeQuestions.length) {
                this.renderQuestion();
            } else {
                alert("Quiz finished!");
                this.showSection('home');
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => { window.app = new SATProApp(); });
</script>
</body>
</html>
